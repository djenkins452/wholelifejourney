{% extends "base.html" %}
{% load static %}
{% block title %}Journal{% endblock %}

{% block content %}

<div class="journal-header">
  <h2 class="page-title">
    Journal
    <span class="count-badge">{{ total_count }}</span>
  </h2>

  <div class="journal-controls">
    <a href="{% url 'journal:create' %}" class="journal-back-link">
      + New Entry
    </a>

    <a href="{% url 'journal:trash' %}" class="journal-trash-link">
      Hidden
      <span class="count-badge subtle">{{ hidden_count }}</span>
    </a>
  </div>
</div>

{% if show_form %}
  <div class="card journal-form-card">
    <form method="post">
      {% csrf_token %}

      {{ form.non_field_errors }}

      <div class="form-row">
        {{ form.entry_date.label_tag }}
        {{ form.entry_date }}
      </div>

      <div class="form-row">
        {{ form.title.label_tag }}
        {{ form.title }}
      </div>

      <div class="form-row">
        {{ form.body.label_tag }}
        {{ form.body }}
      </div>

      <div class="form-actions">
        <button type="submit">
          {% if editing %}Update{% else %}Save{% endif %}
        </button>

        {% if editing %}
          <a href="{% url 'journal:list' %}" class="cancel-link">Cancel</a>
        {% endif %}
      </div>
    </form>
  </div>
{% endif %}

<button class="expand-all" onclick="toggleAll()" id="toggleAllBtn" type="button">
  <img src="{% static 'icons/arrow-right.svg' %}" id="toggleAllIcon" alt="">
  <span id="toggleAllText">Expand all</span>
</button>

{% if grouped_entries %}
  {% for group in grouped_entries %}
    <h3 class="muted" style="margin:16px 0 8px;">
      {{ group.label }}
    </h3>

    <div class="card">
      {% for entry in group.entries %}
        <div class="journal-entry">

          <div class="entry-header">
            <div class="entry-left">
              <strong>
                {% if entry.display_title %}
                  {{ entry.display_title }}
                {% else %}
                  Journal Entry
                {% endif %}
              </strong>

              <div class="muted" style="margin-top:4px;">
                {{ entry.display_date }}
              </div>

              <div class="entry-preview preview" id="preview-{{ entry.id }}">
                {{ entry.body }}
              </div>
            </div>

            <button class="entry-toggle"
                    onclick="toggleEntry('{{ entry.id }}', this)"
                    type="button">
              <img src="{% static 'icons/arrow-right.svg' %}" alt="">
            </button>
          </div>

          <div class="entry-body" id="entry-{{ entry.id }}">
            <div class="entry-text">
              {{ entry.body }}
            </div>

            <div class="entry-actions">
              <a href="{% url 'journal:edit' entry.id %}"
                 class="entry-action entry-action-edit">
                Edit
              </a>

              <button type="button"
                      class="entry-action entry-action-hide"
                      onclick="submitDelete('hide', '{{ entry.id }}')">
                Hide
              </button>

              <button type="button"
                      class="entry-action entry-action-delete"
                      onclick="submitDelete('delete', '{{ entry.id }}')">
                Delete
              </button>
            </div>
          </div>

        </div>
      {% endfor %}
    </div>
  {% endfor %}
{% else %}
  <p class="muted">No journal entries found.</p>
{% endif %}

{% csrf_token %}
<script src="{% static 'js/journal.js' %}"></script>

{% endblock %}
